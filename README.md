# Installing

To install this program simply clone this repository.

Finally, make sure that clingo is installed in your system.
https://github.com/potassco/clingo

# Produce nogoods

To produce nogoods use __produce.py__. To run it needs some files(encoding, etc), an instance and an amount of nogoods to extract. Since the approach relies on assumptions, we need to always add the assumption-solver.py to the files.

Sample call:

```
python produce.py --files encodings/hanoi.lp encodings/assumption-solver.py --instance test-instances/hanoitest.lp --nogoods-limit 100 --max-extraction-time 10
```

For more options such as limiting the size of the learned nogoods see --help.

The nogoods will be saved into a file called __nogoods.lp__

## Validating nogoods
To make sure that the nogoods produced can always be generalized it is possible to validate them after their production.

To validate nogoods use the option `--validate-files`. The value of the option must be a file(s) that can be used to validate them. E.g __validation-encoding/hanoi-validation-normal.lp__ when using hanoi.lp as the encoding.
This validation consists of individually validating each nogood using the instance, the validation encoding and the following program:
```
#const degree={deg}.
hypothesisConstraint({t}-degree) {constraint}
:- not hypothesisConstraint(1).
```
where {deg} is replaced by the degree of the nogood, {t} is replaced by the variable that represents time and {constraint} is replaced by a string that represent the nogood as a contraint.

Sample call:

```
python produce.py --files encodings/hanoi.lp encodings/assumption-solver.py --instance test-instances/hanoitest.lp --nogoods-limit 100 --max-extraction-time 10 --validate-files validation-encoding/hanoi-validation-normal.lp
```

# Consuming nogoods

To consume the nogoods generated by __produce.py__ use the __consume_nogoods.py__ program. A file containing the output nogoods from a __produce.py__ call has to be given as input with the --nogoods option aswell as some sort of scaling(explained below)

Sample call:

```
python consume_nogoods.py --files encodings/hanoi-normal.lp encodings/assumption-solver.py test-instances/hanoitest.lp --nogoods nogoods.lp --scaling-list 2,4,8 
```

## Scaling

The nogoods are consumed based on a set scaling given with the `--scaling-list` or `--scaling-exact` or `--scaling-block` option. 

The `--scaling-list` option is very straightforward. The value should just be a list of integers separated by a comma that indicate how many nogoods should be used in the run. For example: a scaling list of 2,4,8,16,32 will run 5 runs with each run having the amount of nogoods specified in the list. A special scaling of -1 signifies that __ALL__ nogoods will be used for that round.

If the `--scaling-exact` flag is given, then only the specific nogood given in the list will be added to the call.

Lastly, if the `--scaling-block` flag is set, the nogoods will be added as blocks to the call. For example, given the list __10,20,30__, the first 10 nogoods will be run first. Then, the nogoods starting from 10 to 20 will be added. Finally, there will be a run with the nogoods from 20 to 30.

## Configuration File

The configuration file contains information about the location of some important programs.

RUNSOLVER_PATH should contain the path to some runlim binary/call. Otherwise, the path can be given as an option via `--runsolver "path"`

CLINGO should contain the path to some clingo binary/call. Otherwise, it can be given as an option via `--clingo "path"`

### Incremental Mode

To run clingo in incremental mode we need an incremental encoding with the correct format, an instance, and the correct clingo parameters that tells it to log the nogoods it learns. 

An example command is as follows:

```
clingo inc_generalize.py inc_encodings/hanoi-inc.lp test-instances/hanoitest.lp --lemma-out-txt --lemma-out=ng_temp.lp --lemma-out-dom=output --quiet=2 --stats --lemma-out-max=1000
```
It is crucial that the value for the `--lemma-out` option is __ng_temp__.

The parameter *--lemma-out-max=<n>* is used to define how many nogoods to log. Note that the number n means it will log that amount of nogoods **per solving step**.

To further customize the generalization process we can tweak the values inside the configuration file. Some example files are given in the __inc_options__ folder. It includes a file where no nogoods will be added, called base.py. To use these configurations simply add them to the call as any other file.

```
clingo inc_generalize.py inc_encodings/hanoi-inc.lp test-instances/hanoitest.lp inc_options/size50-deg10.py --lemma-out-txt --lemma-out=ng_temp.lp --lemma-out-dom=output --quiet=2 --stats --lemma-out-max=1000
```